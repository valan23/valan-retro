<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valan Archive | Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root { --accent: #00f2ff; --bg: #0b0b0e; --card: #16161a; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; padding: 20px; }
        .header { text-align: center; padding: 20px; }
        h1 { letter-spacing: 5px; color: var(--accent); text-shadow: 0 0 10px rgba(0,242,255,0.3); }
        
        /* Buscador */
        .search-container { max-width: 600px; margin: 20px auto; position: relative; }
        #searchInput { width: 100%; padding: 15px; border-radius: 30px; border: 1px solid #333; background: #222; color: white; font-size: 1em; outline: none; transition: 0.3s; }
        #searchInput:focus { border-color: var(--accent); box-shadow: 0 0 15px rgba(0,242,255,0.1); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
        .card { background: var(--card); border-radius: 15px; padding: 20px; border: 1px solid #222; transition: 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: var(--accent); }
        
        .platform-tag { font-size: 0.7em; font-weight: 800; padding: 4px 10px; border-radius: 5px; background: #ff0055; text-transform: uppercase; margin-bottom: 10px; display: inline-block; }
        .game-title { font-size: 1.1em; font-weight: bold; margin: 10px 0; display: block; height: 2.4em; overflow: hidden; }
        .info-row { font-size: 0.85em; color: #888; display: flex; justify-content: space-between; margin-top: 10px; }
        .price-tag { display: block; margin-top: 15px; color: #00ff88; font-weight: bold; border-top: 1px solid #333; padding-top: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <h1>VALAN ARCHIVE</h1>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Buscar juego o consola..." onkeyup="filterGames()">
        </div>
    </div>

    <div id="game-grid" class="grid"></div>

    <script>
        let allGames = [];
        const csvFile = "Inventario_JuegosRetro - Juegos.csv";

        Papa.parse(csvFile, {
            download: true, 
            header: true,
            skipEmptyLines: true,
            complete: function(results) {
                // Filtro mejorado: solo cogemos filas que tengan un nombre de juego real
                // y que no sean simplemente encabezados o booleanos accidentales
                allGames = results.data.filter(j => {
                    const nombre = j["Juego"] ? j["Juego"].toString().trim() : "";
                    return nombre !== "" && nombre !== "TRUE" && nombre !== "FALSE" && nombre !== "Juego";
                });
                
                console.log("Juegos cargados:", allGames.length); // Esto ayuda a depurar
                renderGames(allGames);
            }
        });

        function renderGames(games) {
            let html = "";
            if (games.length === 0) {
                html = "<p style='text-align:center; width:100%; color:#888;'>No se han encontrado juegos.</p>";
            } else {
                games.forEach(j => {
                    html += `
                        <div class="card">
                            <span class="platform-tag">${j["Plataforma"] || 'Sistema'}</span>
                            <span class="game-title">${j["Juego"]}</span>
                            <div class="info-row">
                                <span>üåç ${j["Regi√≥n"] || '-'}</span>
                                <span>üì¶ ${j["Estado Caja"] || '?'}/10 | üìñ ${j["Estado Manual"] || '?'}/10</span>
                            </div>
                            <span class="price-tag">Tasaci√≥n: ${j["Tasaci√≥n Actual"] || 'S/T'}</span>
                        </div>
                    `;
                });
            }
            document.getElementById('game-grid').innerHTML = html;
        }

        function filterGames() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allGames.filter(j => {
                const titulo = (j["Juego"] || "").toLowerCase();
                const sistema = (j["Plataforma"] || "").toLowerCase();
                return titulo.includes(query) || sistema.includes(query);
            });
            renderGames(filtered);
        }
    </script>
</body>
</html>
